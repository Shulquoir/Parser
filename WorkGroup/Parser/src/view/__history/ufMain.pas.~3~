unit ufMain;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes,
  Vcl.Graphics, Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.ExtDlgs,
  Vcl.Buttons, ShellAPI, Vcl.ExtCtrls, Controller;

type
  TMainForm = class(TForm)
    ePathDFN: TEdit;
    bCreateTSV: TButton;
    bOpenExcel: TButton;
    bOpenCalc: TButton;
    odOpenDFN: TOpenDialog;
    odOpenTSV: TOpenDialog;
    odOpenDFNToMod: TOpenDialog;
    spChooseDFN: TSpeedButton;
    lChoiceDFNForConversion: TLabel;
    sdSaveTSV: TSaveDialog;
    odOpenExcel: TOpenDialog;
    odOpenCalc: TOpenDialog;
    sdSaveDFNToMod: TSaveDialog;
    pCreateTSV: TPanel;
    lChoiceTSVForRewriting: TLabel;
    lChoiceDFNToMod: TLabel;
    spChooseDFNToMod: TSpeedButton;
    spChooseTSV: TSpeedButton;
    bWriteDFN: TButton;
    ePathDFNToMod: TEdit;
    ePathTSV: TEdit;
    pRewriteDFN: TPanel;
    lPanelTitleCreateTSV: TLabel;
    lPanelTitleRewriteDFN: TLabel;
    procedure ePathDFNKeyPress(Sender: TObject; var Key: Char);
    procedure spChooseDFNClick(Sender: TObject);
    procedure spChooseTSVClick(Sender: TObject);
    procedure spChooseDFNToModClick(Sender: TObject);
    procedure bCreateTSVClick(Sender: TObject);
    procedure bOpenExcelClick(Sender: TObject);
    procedure bOpenCalcClick(Sender: TObject);
    procedure ePathTSVKeyPress(Sender: TObject; var Key: Char);
    procedure ePathDFNToModKeyPress(Sender: TObject; var Key: Char);
    procedure bWriteDFNClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure ApplyFilePath(const filePath : String);
  private
    { Private declarations }
    OpenedDFNFilePath, OpenedTSVFilePath, OpenedDFNToModFilePath: string; // Змінні, які будуть зберігати шлях відкритих файлів
    SavedTSVFilePath: string; // Змінна для зберігання шляху створеного TSV файлу для можливості відкрити його в сторонніх програмах
    IsFileCreate: Boolean; // Змінна для перевірки, чи був збережений TSV файл, для відкриття його в сторонніх програмах
    const ENTER_KEY_CODE = #13;
    const STR_OPEN_DFN_FILE_INFORMATION = 'Файл DFN был выбран';
    const STR_FILE_NOT_EXIST = 'Файл не существует: ';

  public
    { Public declarations }
  end;

var
  MainForm: TMainForm;

implementation

{$R *.dfm}

procedure TMainForm.bCreateTSVClick(Sender: TObject);
begin
  IsFileCreate := TController.CreateTSV(OpenedDFNFilePath, SavedTSVFilePath); // Створюємо TSV файл за допомогою
end;                                             // функції, яка повертає значення true, якщо файл був створений

//------------------------------------------------------------------------------

procedure TMainForm.bWriteDFNClick(Sender: TObject);
begin
  TController.RewriteDFN(OpenedTSVFilePath, OpenedDFNToModFilePath);
end;

//------------------------------------------------------------------------------

procedure TMainForm.spChooseDFNClick(Sender: TObject);
begin
  if odOpenDFN.Execute = false then
    Exit;

  ePathDFN.Text := odOpenDFN.FileName;
  OpenedDFNFilePath := ePathDFN.Text;
  MessageDlg(STR_OPEN_DFN_FILE_INFORMATION, mtInformation, [mbOK], 0);
end;

//------------------------------------------------------------------------------

procedure TMainForm.ePathDFNKeyPress(Sender: TObject; var Key: Char);
begin
  if (Key <> ENTER_KEY_CODE) then
    Exit;

  if FileExists(ePathDFN.Text) = false then
  begin
    MessageDlg(STR_FILE_NOT_EXIST + ePathDFN.Text, mtInformation, [mbOK], 0);
    Exit;
  end;

  OpenedDFNFilePath := ePathDFN.Text;
  MessageDlg(STR_OPEN_DFN_FILE_INFORMATION + OpenedDFNFilePath, mtInformation, [mbOK], 0);
end;

//------------------------------------------------------------------------------

procedure TMainForm.spChooseTSVClick(Sender: TObject);
begin
  OpenedTSVFilePath := TController.ChooseFile(odOpenTSV, 'TSV Files|*.tsv');
  if OpenedTSVFilePath <> '' then
    ePathTSV.Text := OpenedTSVFilePath;
end;

//------------------------------------------------------------------------------

procedure TMainForm.ePathTSVKeyPress(Sender: TObject; var Key: Char);
begin
  if TController.OpenFileByName(Sender, Key) then
    OpenedTSVFilePath := ePathTSV.Text;
end;

//------------------------------------------------------------------------------

procedure TMainForm.spChooseDFNToModClick(Sender: TObject);
begin
  if odOpenDFNToMod.Execute = false then
    Exit;

  ePathDFNToMod.Text := odOpenDFNToMod.FileName;
  OpenedDFNToModFilePath := ePathDFNToMod.Text;
  MessageDlg(STR_OPEN_DFN_FILE_INFORMATION, mtInformation, [mbOK], 0);
end;

//------------------------------------------------------------------------------

procedure TMainForm.ePathDFNToModKeyPress(Sender: TObject; var Key: Char);
begin
  if (Key <> ENTER_KEY_CODE) then
    Exit;

  if FileExists(ePathDFNToMod.Text) = false then
  begin
    MessageDlg(STR_FILE_NOT_EXIST + ePathDFNToMod.Text, mtInformation, [mbOK], 0);
    Exit;
  end;

  OpenedDFNToModFilePath := ePathDFNToMod.Text;
  MessageDlg(STR_OPEN_DFN_FILE_INFORMATION, mtInformation, [mbOK], 0);
end;

//------------------------------------------------------------------------------

procedure TMainForm.bOpenExcelClick(Sender: TObject);
begin
  TController.OpenByProgram(SavedTSVFilePath, IsFileCreate, 'Excel');
end;

//------------------------------------------------------------------------------

procedure TMainForm.bOpenCalcClick(Sender: TObject);
begin
   TController.OpenByProgram(SavedTSVFilePath, IsFileCreate, 'Calc');
end;

//------------------------------------------------------------------------------

procedure TMainForm.ApplyFilePath(const filePath : String, var );
begin
   OpenedDFNFilePath := filePath;
   MessageDlg(....);
end;

//------------------------------------------------------------------------------

procedure TMainForm.FormShow(Sender: TObject);
begin
  ePathDFN.SetFocus; // Встановлюємо курсор на перше поле вводу шляху, для швидкого доступу
end;

//------------------------------------------------------------------------------

procedure TMainForm.FormCreate(Sender: TObject);
begin
  IsFileCreate := false; // При створенні форми привласнюємо глобальній змінній, що відповідає за перевірку
end;                                                            // чи був створений TSV файл, значення false

end.
